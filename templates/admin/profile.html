{% extends "admin/_base.html" %}

{% block title %}Profile â€¢ J&T Express{% endblock %}

{% block extra_css %}
<style>
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }
</style>
{% endblock %}

{% block content %}
<header class="content-section card rounded-xl bg-gradient-to-r from-gray-900 via-gray-900 to-black p-3 sm:p-4 md:p-5">
    <h1 class="text-xl sm:text-2xl md:text-3xl font-bold mb-2">Admin Profile</h1>
    <p class="text-gray-400 text-xs sm:text-sm md:text-base">Manage your profile and account settings.</p>
</header>

<section class="content-section card rounded-xl bg-gray-900/80 p-3 sm:p-4 space-y-4 sm:space-y-5">
    <div>
        <h2 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-user-circle text-red-400"></i>
            Profile Information
        </h2>
        <form method="POST" class="space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" aria-label="CSRF Token">
            <input type="hidden" name="action" value="update_profile" aria-label="Form Action">
            <div class="form-grid gap-3 sm:gap-4">
                <div>
                    <label for="full-name" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Full Name *</label>
                    <input type="text" name="full_name" id="full-name" value="{{ profile.full_name if profile else '' }}" autocomplete="name" required class="w-full form-input px-3 py-2 rounded-lg">
                </div>
                <div>
                    <label for="email" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Email *</label>
                    <input type="email" name="email" id="email" value="{{ profile.email if profile else '' }}" autocomplete="email" required class="w-full form-input px-3 py-2 rounded-lg">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="role-display" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Role</label>
                    <input type="text" id="role-display" name="role_display" value="{{ profile.role|title if profile else '' }}" disabled class="w-full form-input px-3 py-2 rounded-lg bg-gray-800 text-gray-400" aria-label="User role (read-only)">
                </div>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-4 border-t border-gray-800">
                <button type="submit" class="btn-primary px-6 py-2.5 rounded-lg font-semibold text-sm shadow-lg">Update Profile</button>
            </div>
        </form>
    </div>
    
    <div>
        <h2 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
            <i class="fas fa-lock text-blue-400"></i>
            Change Password
        </h2>
        <form method="POST" class="space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" aria-label="CSRF Token">
            <input type="hidden" name="action" value="change_password" aria-label="Form Action">
            <div class="form-grid lg:grid-cols-3 gap-3 sm:gap-4">
                <!-- Hidden username field for password autofill accessibility -->
                <label for="username" class="sr-only">Username</label>
                <input type="text" name="username" id="username" autocomplete="username" value="" style="position: absolute; left: -9999px; width: 1px; height: 1px; opacity: 0;" tabindex="-1" aria-hidden="true">
                
                <div>
                    <label for="current-password" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Current Password *</label>
                    <div class="relative">
                        <input type="password" name="current_password" id="current-password" autocomplete="current-password" required class="w-full form-input px-3 py-2 rounded-lg pr-10">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-white focus:outline-none" data-target="current-password" aria-label="Toggle current password visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label for="new-password" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">New Password *</label>
                    <div class="relative">
                        <input type="password" name="new_password" id="new-password" autocomplete="new-password" required minlength="6" class="w-full form-input px-3 py-2 rounded-lg pr-10">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-white focus:outline-none" data-target="new-password" aria-label="Toggle new password visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label for="confirm-password" class="block text-xs uppercase tracking-wide text-gray-400 mb-1">Confirm Password *</label>
                    <div class="relative">
                        <input type="password" name="confirm_password" id="confirm-password" autocomplete="new-password" required minlength="6" class="w-full form-input px-3 py-2 rounded-lg pr-10">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-white focus:outline-none" data-target="confirm-password" aria-label="Toggle confirm password visibility">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 pt-4 border-t border-gray-800">
                <button type="submit" class="btn-primary px-6 py-2.5 rounded-lg font-semibold text-sm shadow-lg">Change Password</button>
            </div>
        </form>
    </div>
    
    <!-- Login history removed -->
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const toggleButtons = document.querySelectorAll('.toggle-password');
    toggleButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.dataset.target;
            const input = document.getElementById(targetId);
            if (!input) return;
            const icon = button.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                if (icon) {
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                }
            } else {
                input.type = 'password';
                if (icon) {
                    icon.classList.add('fa-eye');
                    icon.classList.remove('fa-eye-slash');
                }
            }
        });
    });
});
</script>
{% endblock %}

